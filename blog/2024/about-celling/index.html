<!DOCTYPE html> <html lang="cn, en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> 关于 celling 的设计与实现 | JaynAlpha </title> <meta name="author" content="JaynAplha M. Lo"> <meta name="description" content="About Celling."> <meta name="keywords" content="rust, indie-game, game, bevy, jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/prof_pic_icon.jpg?0088db80d3d88ed402aadbdfaff83f40"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jaynnn.github.io/blog/2024/about-celling/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> JaynAlpha </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/blog/">blog</a> <div class="dropdown-divider"></div> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">关于 celling 的设计与实现</h1> <p class="post-meta"> August 18, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/rust"> <i class="fa-solid fa-hashtag fa-sm"></i> rust</a>   <a href="/blog/tag/bevy"> <i class="fa-solid fa-hashtag fa-sm"></i> bevy</a>   <a href="/blog/tag/marching-squares"> <i class="fa-solid fa-hashtag fa-sm"></i> marching-squares</a>   <a href="/blog/tag/earcut"> <i class="fa-solid fa-hashtag fa-sm"></i> earcut</a>   <a href="/blog/tag/game-of-life"> <i class="fa-solid fa-hashtag fa-sm"></i> game-of-life</a>     ·   <a href="/blog/category/tech"> <i class="fa-solid fa-tag fa-sm"></i> tech</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="目录">目录</h2> <ul> <li><a href="#%E7%9B%AE%E5%BD%95">目录</a></li> <li><a href="#%E5%89%8D%E8%A8%80">前言</a></li> <li><a href="#%E5%89%8D%E7%BD%AE%E5%86%85%E5%AE%B9%E7%AE%80%E4%BB%8B%E7%90%86%E8%A7%A3%E9%A1%B9%E7%9B%AE%E5%BF%85%E9%9C%80">前置内容简介（理解项目必需）</a></li> <li><a href="#%E5%AE%9E%E7%8E%B0">实现</a></li> <li><a href="#%E5%8F%AA%E6%98%AF%E4%B8%AA%E5%8D%8A%E6%88%90%E5%93%81%E6%9C%89%E8%AE%B8%E5%A4%9A%E7%9A%84%E9%97%AE%E9%A2%98%E8%BF%98%E6%B2%A1%E5%BE%97%E5%88%B0%E8%A7%A3%E5%86%B3">只是个半成品，有许多的问题还没得到解决。</a></li> </ul> <h2 id="前言">前言</h2> <h2 id="前置内容简介理解项目必需">前置内容简介（理解项目必需）</h2> <ol> <li>noita <ol> <li>noita是一个2d像素游戏，其核心驱动是一个特殊实现的物理引擎falling everything，这个引擎启发自生命细胞和落沙模拟，celling的大多实现都借鉴自它，可惜它并不开源。关于noita还有许多令人惊叹的设计，比如抽卡式的可编程的连锁法、复杂的怪物AI行为、随机但不失难度梯度的超大世界地图生成、有趣的谜题与彩蛋等，这是我最喜欢的游戏之一，安利一下。</li> </ol> </li> <li>生命细胞与落沙模拟 <ol> <li>生命细胞源于康威的“生命游戏”，其核心就是给定一个简单的演化规则，对于每个细胞的初始状态，能够有持续的演化状态，定好规则与初始状态能够得到一些有趣的演变模式。</li> <li>落沙模拟本质上是一些物理粒子在基本的物理规则下的运动。在celling中，是以像素艺术的像素块为模拟单元，用生命细胞的变形做实现。比如说沙子，制定的规则就是：依次检查下方-左下-右下是否可以落下；又比如水，就是检查下方-左下-右下-左-右是否可以移动。依次类推，根据周围粒子的状态，就可以确定本粒子当前的状态。</li> </ol> </li> <li>bevy与ecs <ol> <li>bevy 是rust写的一个基于webgpu、ecs驱动的现代游戏引擎。</li> <li>ecs是比较现代的一种设计模式，非常适用于游戏。ecs分别是 entity、component、system，entity是实体，实现为一个唯一标识符，唯一标识着游戏中的每个对象，比如玩家、子弹等。component是组件，是实际存放数据的地方，组件会附加在实体身上，从而赋予实体具体的属性，比如说玩家（血量、位置、速度、精灵表等），子弹（位置、速度等）。system是系统，包含了实体的逻辑部分，系统通过查询的方式获取所有包含特定组件的实体，然后对他们进行更新。</li> <li>rust与ecs的交融，天然屏蔽了并行计算带来的复杂性，这是bevy的优势。</li> </ol> </li> <li>marching squares与earcut <ol> <li>这两个算法是用来实现刚体的。</li> <li>marching squares是一种轮廓生成算法，通过设定每个像素块的每个顶点的值，根据一个参数值取差值之后剩下的大于0的顶点（一共有16种状态），生成连起来的轮廓。</li> <li>earcut是一种将多边形拆分成多个三角形的算法。</li> <li>对于世界中演化的像素块，我们始终知道每个像素块的定义值，就可以根据以上两个算法生成许多的三角块，然后塞进比如另外一个物理引擎，比如bevy的bevy_rapier库的根据多个三角形顶点生成刚体的接口，就可以动态地生成可碰撞的实体了。</li> </ol> </li> </ol> <h2 id="实现">实现</h2> <ol> <li><a href="https://github.com/jaynnn/celling" rel="external nofollow noopener" target="_blank">源码</a></li> <li>基础的像素物理演化，如（沙、水、气体）</li> <li>黑白棋盘并行化与像素粒子并行化的抉择。</li> <li>动态刚体生成</li> </ol> <h2 id="只是个半成品有许多的问题还没得到解决">只是个半成品，有许多的问题还没得到解决。</h2> <ol> <li>刚体破坏</li> <li>像素块的遍历顺序问题</li> </ol> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/redis-sorted_set_implement/">redis sorted set 原理</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/tcp-design/">从问题出发考虑TCP的设计原理</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/two-question-about-tcp/">tcp的两点问题</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 JaynAplha M. Lo. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?5d75c11f89cd96294bf5e6dd1ee1bb30"></script> <script defer src="/assets/js/common.js?fcfacfb8c6281f5e68d5a7d348186eb1"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>